<!DOCTYPE html>
<html>
    <head>
        <title>TEST</title>

        <script src="./WebSharper/WebSharper.js" type="text/javascript"></script>
        <script src="./WebSharper/IntelliFactory.WebSharper.dll.js" type="text/javascript"></script>
        <script src="./WebSharper/IntelliFactory.WebSharper.Collections.dll.js" type="text/javascript"></script>

        <script src="./gLong.js" type="text/javascript"></script>
        <script src="./output.js" type="text/javascript"></script>

        <script type="text/javascript">
        IntelliFactory.Runtime.Define(Dalvik, {
            ThreadWorker: {
                requestResource: function(r, cont) {
                                    Dalvik.Manager.processRequest(r, cont);
                                 }
            }
        });

        if (typeof IntelliFactory !== 'undefined')
            IntelliFactory.Runtime.Start();
        </script>
    </head>

    <body>
        <input type="file" id="files" />
        <output id="list"></output>

        <script>
            function handleFileSelect(evt) {
                var file = evt.target.files[0];
                var reader = new FileReader();
                reader.onload = function(e) {
                    var bytes = e.target.result;
                    Dalvik.Manager.init()(bytes);
                }
                reader.readAsArrayBuffer(file);
            }

            document.getElementById('files').addEventListener('change', handleFileSelect, false);

            function spawnThread() {
                w = new Worker('thread.js');
                w.onmessage = function(e) {
                    Dalvik.Manager.processRequest(e.data, function(reply) {
                        w.postMessage(reply);
                    });
                }
                return w;
            }
        </script>

    </body
</html>
